// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`emitWorker > generates worker code with Vite bundler 1`] = `
"// generated by pyodide-bridge (DO NOT EDIT)

import * as Comlink from "comlink";
import { bootstrapPyodide, deepConvertMaps, detectBridgeError } from "pyodide-bridge/runtime";

import pythonSource from "./engine.py?raw";

import type { InputParams, Result } from "./engine.types.js";

export interface BridgeAPI {
  run_query(params: InputParams): Promise<Result>;
}

let pyodide: Awaited<ReturnType<typeof bootstrapPyodide>>;

async function init(): Promise<void> {
  pyodide = await bootstrapPyodide({
    pyodideVersion: "0.26.4",
    packages: ["numpy"],
    pythonSource,
  });
}

const api: BridgeAPI = {
  async run_query(params: InputParams): Promise<Result> {
    const globals = pyodide.globals;
    const pyFunc = globals.get("run_query");
    const pyResult = pyFunc(pyodide.toPy(params));
    const jsResult = deepConvertMaps<Result>(pyResult.toJs());
    detectBridgeError(jsResult);
    return jsResult;
  }
};

init().then(() => {
  Comlink.expose(api);
});
"
`;
