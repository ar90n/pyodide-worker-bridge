// generated by pyodide-bridge (DO NOT EDIT)

import * as Comlink from "comlink";
import { bootstrapPyodide, deepConvertMaps, detectBridgeError } from "pyodide-bridge/runtime";

import pythonSource from "./geometry.py?raw";

import type { MeshParams, MeshResult } from "./geometry.types.js";

export interface BridgeAPI {
  generate_mesh(params: MeshParams): Promise<MeshResult>;
}

let pyodide: Awaited<ReturnType<typeof bootstrapPyodide>>;

async function init(): Promise<void> {
  pyodide = await bootstrapPyodide({
    pyodideVersion: "0.27.5",
    packages: ["numpy"],
    pythonSource,
  });
}

const api: BridgeAPI = {
  async generate_mesh(params: MeshParams): Promise<MeshResult> {
    const globals = pyodide.globals;
    const pyFunc = globals.get("generate_mesh");
    const pyResult = pyFunc(pyodide.toPy(params));
    const jsResult = deepConvertMaps<MeshResult>(pyResult.toJs());
    detectBridgeError(jsResult);
    return jsResult;
  }
};

init().then(() => {
  Comlink.expose(api);
});
